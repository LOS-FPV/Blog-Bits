---
import Layout from '../../layouts/Layout.astro';

// ✅ Declare and assign `allPosts` at the top level
const allPosts = import.meta.glob('../../content/posts/*.mdx');

export async function getStaticPaths() {
  return Object.keys(allPosts).map((file) => {
    const slug = file.split('/').pop().replace('.mdx', '');
    return { params: { slug } };
  });
}

const slug = Astro.params.slug;
const postPath = `../../content/posts/${slug}.mdx`;

// ✅ This loads the MDX module and extracts frontmatter + content
const post = await allPosts[postPath]();
const { frontmatter, default: Content } = post;
---

<Layout title={frontmatter.title}>
  <article class="prose mx-auto">
    <h1>{frontmatter.title}</h1>
    <p class="text-sm text-gray-500">{frontmatter.date}</p>
    <Content />
  </article>
</Layout>
